make_index: |
  CREATE INDEX FOR (i:Interpro) ON (i.ENTRY_TYPE);
  CREATE INDEX FOR (p:Entity) ON (p.TYPE);

bound_ligand_query: |
    MATCH
    (bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "b", POLYMER_TYPE: "B"})<-[c:HAS_ENTITY]-(a:Entry)-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})
    WHERE
    e.EC IS NOT NULL AND
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH a.ID as pdb_id, e.UNIQID as protein_entity_id , p.UNIQID as ligand_entity_id, bl.UNIQID as bl_uniqid, bm.UNIQID as bm_uniqid, part.SYM_OPERATOR as bm_bl_sym_op 
    ORDER BY bm_uniqid, bl_uniqid
    RETURN pdb_id, protein_entity_id, ligand_entity_id, bl_uniqid, COLLECT(bm_uniqid) as bm_uniqids, COLLECT(bm_bl_sym_op) as bm_bl_sym_ops

bound_ligand_sifts: |
    MATCH
    (bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "b", POLYMER_TYPE: "B"})<-[c:HAS_ENTITY]-(a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_ARP_CONTACT]->(pr:PDBResidue)-[:HAS_ARP_CONTACT {AUTH_ASYM_ID_2: $chain}]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH a.ID as pdb_id, e.UNIQID as protein_entity_id , ch.STRUCT_ASYM_ID as chain_id, ch.AUTH_ASYM_ID as auth_chain_id, p.UNIQID as ligand_entity_id, bl.UNIQID as bl_uniqid, bm.UNIQID as bm_uniqid, part.SYM_OPERATOR as bm_bl_sym_op 
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bl_uniqid
    RETURN pdb_id, protein_entity_id, chain_id, auth_chain_id, ligand_entity_id, bl_uniqid, COLLECT(bm_uniqid) as bm_uniqids, COLLECT(bm_bl_sym_op) as bm_bl_sym_ops

bound_sugar_query: |
    MATCH
    (bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "s", POLYMER_TYPE: "S"})<-[c:HAS_ENTITY]-(a:Entry)-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})
    WHERE
    e.EC IS NOT NULL AND
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH a.ID as pdb_id, e.UNIQID as protein_entity_id , p.UNIQID as ligand_entity_id, bl.UNIQID as bl_uniqid, bm.UNIQID as bm_uniqid, part.SYM_OPERATOR as bm_bl_sym_op 
    ORDER BY bm_uniqid, bl_uniqid
    RETURN pdb_id, protein_entity_id, ligand_entity_id, bl_uniqid,  COLLECT(bm_uniqid) as bm_uniqids, COLLECT(bm_bl_sym_op) as bm_bl_sym_ops

bound_sugar_sifts: |
    MATCH
    (bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "s", POLYMER_TYPE: "S"})<-[c:HAS_ENTITY]-(a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:CONTAINS_CHAIN]->(ch:Chain {AUTH_ASYM_ID : $chain})
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH a.ID as pdb_id, e.UNIQID as protein_entity_id , ch.STRUCT_ASYM_ID as chain_id, ch.AUTH_ASYM_ID as auth_chain_id, p.UNIQID as ligand_entity_id, bl.UNIQID as bl_uniqid, bm.UNIQID as bm_uniqid, part.SYM_OPERATOR as bm_bl_sym_op 
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bl_uniqid
    RETURN pdb_id, protein_entity_id, chain_id, auth_chain_id, ligand_entity_id, bl_uniqid,  COLLECT(bm_uniqid) as bm_uniqids, COLLECT(bm_bl_sym_op) as bm_bl_sym_ops



cath_bl_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "b", POLYMER_TYPE: "B"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH p MATCH (p)-[:IS_A]->(cc:ChemicalComponent)-[:DESCRIBED_BY]->(cd:ChemicalComponentDesc {TYPE : "SMILES_CANONICAL"}) RETURN cd LIMIT 1}
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[cath_rel:IS_IN_CATH_DOMAIN]->(cath:CATH) RETURN cath_rel, cath}
    WITH a.ID as pdb_id, a.DESCRIPTOR as pdb_descriptor, a.TITLE as pdb_title, a.KEYWORDS as pdb_keywords, e.UNIQID as protein_entity_id , e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.UNIQID as uniqueID, 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    cd.DESCRIPTOR as descriptor, bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    cath.DOMAIN as cath_name, cath.CLASS as cath_class, 
    cath.ARCH as cath_architecture, cath.TOPOL as cath_topology, 
    cath.HOMOL as cath_homology, cath.CATHCODE as cath_code, 
    cath_rel.STRUCT_ASYM_ID as cath_chain, bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op
    WHERE cath_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count,
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    uniqueID, 
    "ligand" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    cath_name, 
    cath_class, 
    cath_architecture, 
    cath_topology, 
    cath_homology, 
    cath_code, 
    cath_chain, 
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

cath_sugar_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "s", POLYMER_TYPE: "S"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[cath_rel:IS_IN_CATH_DOMAIN]->(cath:CATH) RETURN cath_rel, cath}
    WITH a.ID as pdb_id, a.DESCRIPTOR as pdb_descriptor, 
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2,  
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.CHEM_COMP_ID as bound_ligand_name,
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    cath.DOMAIN as cath_name, cath.CLASS as cath_class, cath.ARCH as cath_architecture, cath.TOPOL as cath_topology, cath.HOMOL as cath_homology, cath.CATHCODE as cath_code, cath_rel.STRUCT_ASYM_ID as cath_chain, bm.UNIQID as bm_uniqid, bm.ID as bound_molecule_display_id, part.SYM_OPERATOR as bm_bl_sym_op
    WHERE cath_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count, 
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id,  
    "sugar" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id,  
    bl_name, 
    cath_name, 
    cath_class, 
    cath_architecture, 
    cath_topology, 
    cath_homology, 
    cath_code, 
    cath_chain,
    collect(DISTINCT(bm_uniqid))[0] + "_" + ligand_entity_id_numerical + "_" + bound_ligand_struct_asym_id as uniqueID, 
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

scop_bl_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "b", POLYMER_TYPE: "B"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH p MATCH (p)-[:IS_A]->(cc:ChemicalComponent)-[:DESCRIBED_BY]->(cd:ChemicalComponentDesc {TYPE : "SMILES_CANONICAL"}) RETURN cd LIMIT 1}
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[scop_rel:IS_IN_SCOP_DOMAIN]->(scop:SCOP) RETURN scop_rel, scop}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.UNIQID as uniqueID, 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    cd.DESCRIPTOR as descriptor, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    scop.SUNID as scop_sunid,
    scop.DESCRIPTION as scop_description,
    scop.SCCS as scop_sccs,
    scop_rel.CLASS_ID as scop_class_id,
    scop_rel.FOLD_ID as scop_fold_id,
    scop_rel.SUPERFAMILY_ID as scop_superfamily_id,
    scop_rel.SCOP_ID as scop_id,
    scop_rel.STRUCT_ASYM_ID as scop_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op, 
    WHERE scop_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count, 
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    uniqueID, 
    "ligand" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    scop_sunid, 
    scop_description, 
    scop_sccs, 
    scop_class_id, 
    scop_fold_id, 
    scop_superfamily_id, 
    scop_id,
    scop_chain,
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

scop_sugar_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "s", POLYMER_TYPE: "S"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[scop_rel:IS_IN_SCOP_DOMAIN]->(scop:SCOP) RETURN scop_rel, scop}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    scop.SUNID as scop_sunid,
    scop.DESCRIPTION as scop_description,
    scop.SCCS as scop_sccs,
    scop_rel.CLASS_ID as scop_class_id,
    scop_rel.FOLD_ID as scop_fold_id,
    scop_rel.SUPERFAMILY_ID as scop_superfamily_id,
    scop_rel.SCOP_ID as scop_id,
    scop_rel.STRUCT_ASYM_ID as scop_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op, 
    WHERE scop_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count, 
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id,  
    "sugar" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    scop_sunid, 
    scop_description, 
    scop_sccs, 
    scop_class_id, 
    scop_fold_id, 
    scop_superfamily_id, 
    scop_id,
    scop_chain,
    collect(DISTINCT(bm_uniqid))[0] + "_" + ligand_entity_id_numerical + "_" + bound_ligand_struct_asym_id as uniqueID,
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

interpro_d_bl_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "b", POLYMER_TYPE: "B"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH p MATCH (p)-[:IS_A]->(cc:ChemicalComponent)-[:DESCRIBED_BY]->(cd:ChemicalComponentDesc {TYPE : "SMILES_CANONICAL"}) RETURN cd LIMIT 1}
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[ip:IS_IN_INTERPRO]->(i:Interpro {ENTRY_TYPE: "D"}) RETURN ip, i}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.UNIQID as uniqueID, 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    cd.DESCRIPTOR as descriptor, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    i.ABBREV as interpro_type,
    i.INTERPRO_ACCESSION as interpro_accession,
    i.NAME as interpro_name,
    ip.STRUCT_ASYM_ID as interpro_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op, 
    WHERE interpro_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count,
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    uniqueID, 
    "ligand" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    interpro_type, 
    interpro_accession, 
    interpro_name, 
    interpro_chain, 
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

interpro_d_sugar_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "s", POLYMER_TYPE: "S"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[ip:IS_IN_INTERPRO]->(i:Interpro {ENTRY_TYPE: "D"}) RETURN ip, i}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    i.ABBREV as interpro_type,
    i.INTERPRO_ACCESSION as interpro_accession,
    i.NAME as interpro_name,
    ip.STRUCT_ASYM_ID as interpro_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op, 
    WHERE interpro_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count,
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    "sugar" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    interpro_type, 
    interpro_accession, 
    interpro_name, 
    interpro_chain,
    collect(DISTINCT(bm_uniqid))[0] + "_" + ligand_entity_id_numerical + "_" + bound_ligand_struct_asym_id as uniqueID,
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

interpro_f_bl_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "b", POLYMER_TYPE: "B"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH p MATCH (p)-[:IS_A]->(cc:ChemicalComponent)-[:DESCRIBED_BY]->(cd:ChemicalComponentDesc {TYPE : "SMILES_CANONICAL"}) RETURN cd LIMIT 1}
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[ip:IS_IN_INTERPRO]->(i:Interpro {ENTRY_TYPE: "F"}) RETURN ip, i}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.UNIQID as uniqueID, 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    cd.DESCRIPTOR as descriptor, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    i.ABBREV as interpro_type,
    i.INTERPRO_ACCESSION as interpro_accession,
    i.NAME as interpro_name,
    ip.STRUCT_ASYM_ID as interpro_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op, 
    WHERE interpro_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count,
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    uniqueID, 
    "ligand" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    interpro_type, 
    interpro_accession, 
    interpro_name, 
    interpro_chain, 
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

interpro_f_sugar_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "s", POLYMER_TYPE: "S"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[ip:IS_IN_INTERPRO]->(i:Interpro {ENTRY_TYPE: "F"}) RETURN ip, i}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id,
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    i.ABBREV as interpro_type,
    i.INTERPRO_ACCESSION as interpro_accession,
    i.NAME as interpro_name,
    ip.STRUCT_ASYM_ID as interpro_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op, 
    WHERE interpro_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count, 
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    "sugar" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    interpro_type, 
    interpro_accession, 
    interpro_name, 
    interpro_chain,
    collect(DISTINCT(bm_uniqid))[0] + "_" + ligand_entity_id_numerical + "_" + bound_ligand_struct_asym_id as uniqueID,
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

interpro_h_bl_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "b", POLYMER_TYPE: "B"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH p MATCH (p)-[:IS_A]->(cc:ChemicalComponent)-[:DESCRIBED_BY]->(cd:ChemicalComponentDesc {TYPE : "SMILES_CANONICAL"}) RETURN cd LIMIT 1}
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[ip:IS_IN_INTERPRO]->(i:Interpro {ENTRY_TYPE: "H"}) RETURN ip, i}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id , 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.UNIQID as uniqueID, 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    cd.DESCRIPTOR as descriptor, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\[\]' ]", ""), ",") as contact_type, 
    i.ABBREV as interpro_type,
    i.INTERPRO_ACCESSION as interpro_accession,
    i.NAME as interpro_name,
    ip.STRUCT_ASYM_ID as interpro_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op, 
    WHERE interpro_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count,
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    uniqueID, 
    "ligand" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    interpro_type, 
    interpro_accession, 
    interpro_name, 
    interpro_chain, 
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops

interpro_h_sugar_query: |
    MATCH
    (a:Entry {ID: $pdb_id})-[z:HAS_ENTITY]->(e:Entity  {TYPE : 'p', POLYMER_TYPE : 'P'})-[:HAS_PDB_RESIDUE]->(pr:PDBResidue)<-[Arp:HAS_ARP_CONTACT]-(bl:BoundLigand)-[part:IS_PART_OF]-(bm:BoundMolecule)-[k:HAS_ENTITY]->(p:Entity {TYPE: "s", POLYMER_TYPE: "S"})-[:IS_AN_INSTANCE_OF]->(bl)
    WHERE
    NOT bl.CHEM_COMP_ID in ["UNX", "UNL"] AND (Arp.SYM_OP_1 IS NULL OR part.SYM_OPERATOR IS NULL OR Arp.SYM_OP_1 = part.SYM_OPERATOR) AND bl.CHEM_COMP_ID in split(p.CHEM_COMP_LIST, ",")
    WITH *
    CALL {WITH e,pr  MATCH (e)-[:HAS_PDB_RESIDUE]->(pr)-[ip:IS_IN_INTERPRO]->(i:Interpro {ENTRY_TYPE: "H"}) RETURN ip, i}
    WITH a.ID as pdb_id, 
    a.DESCRIPTOR as pdb_descriptor,
    a.TITLE as pdb_title, 
    a.KEYWORDS as pdb_keywords, 
    e.UNIQID as protein_entity_id, 
    e.DESCRIPTION as protein_entity_description,  
    Arp.STRUCT_ASYM_ID_2 as chain_id, 
    Arp.AUTH_SEQ_ID_1 as auth_1, 
    Arp.AUTH_SEQ_ID_2 as auth_2, 
    p.UNIQID as ligand_entity_id, 
    p.ID as ligand_entity_id_numerical, 
    p.DESCRIPTION as description, 
    bl.UNIQID as bound_ligand_id, 
    bl.CHEM_COMP_ID as bound_ligand_name, 
    bl.STRUCT_ASYM_ID as bound_ligand_struct_asym_id, 
    bl.CHEM_COMP_ID as bl_name, 
    split(apoc.text.replace(Arp.CONTACT_TYPE, "[\\[\\]\\' ]", ""), ",") as contact_type,
    i.ABBREV as interpro_type,
    i.INTERPRO_ACCESSION as interpro_accession,
    i.NAME as interpro_name,
    ip.STRUCT_ASYM_ID as interpro_chain, 
    bm.UNIQID as bm_uniqid, 
    bm.ID as bound_molecule_display_id, 
    part.SYM_OPERATOR as bm_bl_sym_op
    WHERE interpro_chain = chain_id AND contact_type <> ['vdw_clash'] AND contact_type <> ['clash']
    WITH *
    ORDER BY pdb_id, protein_entity_id, chain_id, bm_uniqid, bound_ligand_id
    RETURN
    pdb_id, 
    pdb_descriptor, 
    pdb_title, 
    pdb_keywords, 
    protein_entity_id , 
    protein_entity_description, 
    chain_id,
    protein_entity_id + "_" + chain_id as chainUniqueID,
    apoc.text.join(collect(DISTINCT(auth_1)), "|") as auth_1, 
    apoc.text.join(collect(DISTINCT(auth_2)), "|") as auth_2,
    apoc.coll.occurrences(apoc.coll.flatten(collect(contact_type)), "hbond") as hbond_count, 
    size(collect(contact_type)) as contact_type_count,
    ligand_entity_id, 
    ligand_entity_id_numerical, 
    description, 
    bound_ligand_id, 
    uniqueID, 
    "sugar" as type,
    bound_ligand_name, 
    bound_ligand_struct_asym_id, 
    descriptor, 
    bl_name, 
    interpro_type, 
    interpro_accession, 
    interpro_name, 
    interpro_chain,
    collect(DISTINCT(bm_uniqid))[0] + "_" + ligand_entity_id_numerical + "_" + bound_ligand_struct_asym_id as uniqueID
    apoc.text.join(collect(DISTINCT(bm_uniqid)), "|") as bm_uniqids, 
    apoc.text.join(collect(DISTINCT(bound_molecule_display_id)), "|") as bound_molecule_display_ids, 
    apoc.text.join(collect(DISTINCT(bm_bl_sym_op)), "|") as bm_bl_sym_ops